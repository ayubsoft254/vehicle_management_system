{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - {{ dashboard.name }}{% endblock %}

{% block extra_css %}
<style>
    .widget-container {
        transition: all 0.3s ease;
    }
    .widget-container:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    .sidebar-open {
        transform: translateX(0);
    }
    .sidebar-closed {
        transform: translateX(100%);
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 shadow-lg">
        <div class="px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <div class="flex items-center space-x-4">
                    <h1 class="text-2xl font-bold text-white">
                        {% if dashboard %}
                            <i class="fas fa-tachometer-alt mr-2"></i>{{ dashboard.name }}
                        {% else %}
                            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                        {% endif %}
                    </h1>
                    {% if dashboard and not preference.default_dashboard or preference.default_dashboard.pk != dashboard.pk %}
                        <form method="post" action="{% url 'dashboard:set_default' dashboard.pk %}" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg text-sm transition duration-200" title="Set as Default">
                                <i class="fas fa-star mr-1"></i>Set Default
                            </button>
                        </form>
                    {% endif %}
                    {% if dashboard and preference.default_dashboard.pk == dashboard.pk %}
                        <span class="bg-yellow-500 text-white px-3 py-1 rounded-lg text-sm">
                            <i class="fas fa-star mr-1"></i>Default
                        </span>
                    {% endif %}
                </div>
                <div class="flex items-center space-x-3">
                    <!-- Dashboard Selector -->
                    <div class="relative">
                        <button id="dashboardSelectorBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center">
                            <i class="fas fa-th-large mr-2"></i>Dashboards
                            <i class="fas fa-chevron-down ml-2"></i>
                        </button>
                        <div id="dashboardSelectorMenu" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl z-50">
                            <div class="py-2">
                                <a href="{% url 'dashboard:dashboard_list' %}" class="block px-4 py-2 text-gray-700 hover:bg-blue-50">
                                    <i class="fas fa-list mr-2"></i>View All Dashboards
                                </a>
                                <a href="{% url 'dashboard:dashboard_create' %}" class="block px-4 py-2 text-gray-700 hover:bg-blue-50">
                                    <i class="fas fa-plus mr-2"></i>Create New Dashboard
                                </a>
                                {% if dashboard %}
                                    <a href="{% url 'dashboard:dashboard_update' dashboard.pk %}" class="block px-4 py-2 text-gray-700 hover:bg-blue-50">
                                        <i class="fas fa-edit mr-2"></i>Edit Dashboard
                                    </a>
                                    <a href="{% url 'dashboard:share_dashboard' dashboard.pk %}" class="block px-4 py-2 text-gray-700 hover:bg-blue-50">
                                        <i class="fas fa-share-alt mr-2"></i>Share Dashboard
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Preferences Toggle -->
                    <button id="preferencesToggle" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition duration-200">
                        <i class="fas fa-cog"></i>
                    </button>

                    <!-- Quick Actions -->
                    <a href="{% url 'dashboard:quick_actions' %}" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition duration-200">
                        <i class="fas fa-bolt"></i>
                    </a>

                    <!-- User Menu -->
                    <div class="flex items-center space-x-2 bg-white bg-opacity-20 rounded-lg px-3 py-2">
                        <span class="text-white text-sm">{{ user.get_full_name|default:user.username }}</span>
                        <a href="{% url 'logout' %}" class="text-white hover:text-red-300 transition duration-200">
                            <i class="fas fa-sign-out-alt"></i>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Dashboard Actions Bar -->
            {% if dashboard %}
                <div class="flex items-center justify-between pb-4 border-t border-white border-opacity-20 pt-4">
                    <div class="flex items-center space-x-2">
                        <a href="{% url 'dashboard:widget_create' dashboard.pk %}" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition duration-200 text-sm">
                            <i class="fas fa-plus mr-2"></i>Add Widget
                        </a>
                        <a href="{% url 'dashboard:widget_templates' dashboard.pk %}" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition duration-200 text-sm">
                            <i class="fas fa-th mr-2"></i>Widget Templates
                        </a>
                        <button id="refreshDashboard" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition duration-200 text-sm">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                    <div class="flex items-center space-x-2 text-white text-sm">
                        <span><i class="fas fa-eye mr-1"></i>Layout: {{ dashboard.layout|title }}</span>
                        <span class="mx-2">|</span>
                        <span><i class="fas fa-columns mr-1"></i>Columns: {{ dashboard.columns }}</span>
                        <span class="mx-2">|</span>
                        <span><i class="fas fa-clock mr-1"></i>Last updated: {{ dashboard.updated_at|timesince }} ago</span>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- Dashboard Content -->
    <div class="px-4 sm:px-6 lg:px-8 py-8">
        {% if dashboard %}
            <!-- Overview Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total Vehicles -->
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-blue-100 text-sm font-medium mb-1">Total Vehicles</p>
                            <p class="text-3xl font-bold">
                                {% if overview_data.total_vehicles %}{{ overview_data.total_vehicles }}{% else %}0{% endif %}
                            </p>
                            <p class="text-blue-100 text-xs mt-1">
                                <i class="fas fa-arrow-up mr-1"></i>Active in fleet
                            </p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-4">
                            <i class="fas fa-car text-3xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Active Clients -->
                <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm font-medium mb-1">Active Clients</p>
                            <p class="text-3xl font-bold">
                                {% if overview_data.total_clients %}{{ overview_data.total_clients }}{% else %}0{% endif %}
                            </p>
                            <p class="text-green-100 text-xs mt-1">
                                <i class="fas fa-user-check mr-1"></i>Registered users
                            </p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-4">
                            <i class="fas fa-users text-3xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Monthly Revenue -->
                <div class="bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-yellow-100 text-sm font-medium mb-1">Monthly Revenue</p>
                            <p class="text-3xl font-bold">
                                {% if overview_data.monthly_revenue %}${{ overview_data.monthly_revenue|floatformat:0 }}{% else %}$0{% endif %}
                            </p>
                            <p class="text-yellow-100 text-xs mt-1">
                                <i class="fas fa-chart-line mr-1"></i>This month
                            </p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-4">
                            <i class="fas fa-dollar-sign text-3xl"></i>
                        </div>
                    </div>
                </div>

                <!-- Pending Sales -->
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white transform hover:scale-105 transition duration-300">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-purple-100 text-sm font-medium mb-1">Pending Sales</p>
                            <p class="text-3xl font-bold">
                                {% if overview_data.pending_sales %}{{ overview_data.pending_sales }}{% else %}0{% endif %}
                            </p>
                            <p class="text-purple-100 text-xs mt-1">
                                <i class="fas fa-hourglass-half mr-1"></i>Awaiting completion
                            </p>
                        </div>
                        <div class="bg-white bg-opacity-20 rounded-full p-4">
                            <i class="fas fa-chart-line text-3xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Widgets Section -->
            {% if widgets %}
                <div class="mb-6 flex items-center justify-between">
                    <h2 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-cubes mr-2 text-blue-600"></i>Dashboard Widgets
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button id="gridViewBtn" class="bg-blue-100 text-blue-600 px-3 py-2 rounded-lg hover:bg-blue-200 transition duration-200">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button id="listViewBtn" class="bg-gray-100 text-gray-600 px-3 py-2 rounded-lg hover:bg-gray-200 transition duration-200">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>

                <!-- Grid Layout (based on dashboard.columns) -->
                <div id="widgetsGrid" class="grid grid-cols-1 {% if dashboard.columns == 1 %}lg:grid-cols-1{% elif dashboard.columns == 2 %}lg:grid-cols-2{% elif dashboard.columns == 3 %}lg:grid-cols-3{% else %}lg:grid-cols-4{% endif %} gap-6">
                    {% for widget in widgets %}
                        <div class="widget-container bg-white rounded-xl shadow-lg overflow-hidden">
                            <!-- Widget Header -->
                            <div class="bg-gradient-to-r from-{{ widget.color_scheme }}-500 to-{{ widget.color_scheme }}-600 px-6 py-4 flex items-center justify-between">
                                <h3 class="text-lg font-bold text-white flex items-center">
                                    <i class="fas fa-{{ widget.icon|default:'chart-bar' }} mr-2"></i>
                                    {{ widget.title }}
                                </h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="refreshWidget({{ widget.pk }})" class="text-white hover:text-gray-200 transition duration-200" title="Refresh Widget">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <a href="{% url 'dashboard:widget_update' widget.pk %}" class="text-white hover:text-gray-200 transition duration-200" title="Edit Widget">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <button onclick="deleteWidget({{ widget.pk }})" class="text-white hover:text-red-200 transition duration-200" title="Delete Widget">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Widget Body -->
                            <div class="p-6">
                                {% if widget.description %}
                                    <p class="text-gray-600 text-sm mb-4">{{ widget.description }}</p>
                                {% endif %}

                                <!-- Widget Content Based on Type -->
                                {% if widget.widget_type == 'STAT' %}
                                    <!-- Statistics Widget -->
                                    <div class="text-center">
                                        <div class="text-4xl font-bold text-{{ widget.color_scheme }}-600 mb-2">
                                            {{ widget.get_widget_data.value|default:"0" }}
                                        </div>
                                        <p class="text-gray-500 text-sm">{{ widget.get_widget_data.label|default:"Value" }}</p>
                                    </div>

                                {% elif widget.widget_type == 'CHART' %}
                                    <!-- Chart Widget -->
                                    <div class="h-64">
                                        <canvas id="chart-{{ widget.pk }}"></canvas>
                                    </div>

                                {% elif widget.widget_type == 'TABLE' %}
                                    <!-- Table Widget -->
                                    <div class="overflow-x-auto">
                                        <table class="min-w-full divide-y divide-gray-200">
                                            <thead class="bg-gray-50">
                                                <tr>
                                                    {% for header in widget.get_widget_data.headers %}
                                                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                            {{ header }}
                                                        </th>
                                                    {% endfor %}
                                                </tr>
                                            </thead>
                                            <tbody class="bg-white divide-y divide-gray-200">
                                                {% for row in widget.get_widget_data.rows %}
                                                    <tr>
                                                        {% for cell in row %}
                                                            <td class="px-4 py-3 text-sm text-gray-900">{{ cell }}</td>
                                                        {% endfor %}
                                                    </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>

                                {% elif widget.widget_type == 'LIST' %}
                                    <!-- List Widget -->
                                    <ul class="space-y-2">
                                        {% for item in widget.get_widget_data.items %}
                                            <li class="flex items-center justify-between py-2 border-b border-gray-100">
                                                <span class="text-gray-700">{{ item.label }}</span>
                                                <span class="font-semibold text-{{ widget.color_scheme }}-600">{{ item.value }}</span>
                                            </li>
                                        {% endfor %}
                                    </ul>

                                {% elif widget.widget_type == 'METRIC' %}
                                    <!-- Metric Widget -->
                                    <div class="grid grid-cols-2 gap-4">
                                        {% for metric in widget.get_widget_data.metrics %}
                                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                                <div class="text-2xl font-bold text-{{ widget.color_scheme }}-600">
                                                    {{ metric.value }}
                                                </div>
                                                <p class="text-xs text-gray-500 mt-1">{{ metric.label }}</p>
                                            </div>
                                        {% endfor %}
                                    </div>

                                {% else %}
                                    <!-- Default Content -->
                                    <div class="text-center py-8 text-gray-500">
                                        <i class="fas fa-chart-bar text-4xl mb-3"></i>
                                        <p>Widget data will be displayed here</p>
                                    </div>
                                {% endif %}

                                <!-- Widget Footer -->
                                {% if widget.show_footer %}
                                    <div class="mt-4 pt-4 border-t border-gray-200 flex items-center justify-between text-xs text-gray-500">
                                        <span>
                                            <i class="fas fa-clock mr-1"></i>
                                            Updated {{ widget.updated_at|timesince }} ago
                                        </span>
                                        {% if widget.data_source %}
                                            <span>
                                                <i class="fas fa-database mr-1"></i>
                                                {{ widget.get_data_source_display }}
                                            </span>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <!-- No Widgets -->
                <div class="bg-white rounded-xl shadow-lg p-12 text-center">
                    <div class="max-w-md mx-auto">
                        <div class="bg-blue-100 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-chart-bar text-5xl text-blue-600"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-900 mb-3">No Widgets Configured</h3>
                        <p class="text-gray-600 mb-6">Start by adding some widgets to your dashboard to visualize your data.</p>
                        <div class="flex justify-center space-x-3">
                            <a href="{% url 'dashboard:widget_create' dashboard.pk %}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-300 inline-flex items-center">
                                <i class="fas fa-plus mr-2"></i>Add Widget
                            </a>
                            <a href="{% url 'dashboard:widget_templates' dashboard.pk %}" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition duration-300 inline-flex items-center">
                                <i class="fas fa-th mr-2"></i>Browse Templates
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% else %}
            <!-- No Dashboard Found -->
            <div class="bg-white rounded-xl shadow-lg p-12 text-center max-w-2xl mx-auto">
                <div class="bg-yellow-100 rounded-full w-24 h-24 flex items-center justify-center mx-auto mb-6">
                    <i class="fas fa-exclamation-triangle text-5xl text-yellow-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 mb-3">No Dashboard Found</h3>
                <p class="text-gray-600 mb-6">It looks like you don't have a dashboard set up yet. Let's create one to get started!</p>
                <div class="flex justify-center space-x-3">
                    <a href="{% url 'dashboard:dashboard_create' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-300 inline-flex items-center">
                        <i class="fas fa-plus mr-2"></i>Create Dashboard
                    </a>
                    <a href="{% url 'dashboard:create_from_template' %}" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg transition duration-300 inline-flex items-center">
                        <i class="fas fa-magic mr-2"></i>Use Template
                    </a>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- Preferences Sidebar -->
    <div id="preferencesSidebar" class="fixed right-0 top-0 h-full w-96 bg-white shadow-2xl transform transition-transform duration-300 sidebar-closed z-50">
        <div class="h-full flex flex-col">
            <!-- Sidebar Header -->
            <div class="bg-gradient-to-r from-blue-600 to-indigo-700 px-6 py-4 flex items-center justify-between">
                <h3 class="text-lg font-bold text-white">
                    <i class="fas fa-cog mr-2"></i>Dashboard Preferences
                </h3>
                <button id="closeSidebar" class="text-white hover:text-gray-200">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <!-- Sidebar Content -->
            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                <!-- Theme Selection -->
                <div>
                    <h4 class="text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-palette mr-2 text-purple-600"></i>Theme
                    </h4>
                    <form method="post" action="{% url 'dashboard:update_preference' %}" id="themeForm">
                        {% csrf_token %}
                        <input type="hidden" name="preference_type" value="theme">
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="theme" value="light" {% if preference.theme == 'light' %}checked{% endif %} class="mr-3" onchange="this.form.submit()">
                                <span class="flex-1">
                                    <i class="fas fa-sun text-yellow-500 mr-2"></i>Light Theme
                                </span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="theme" value="dark" {% if preference.theme == 'dark' %}checked{% endif %} class="mr-3" onchange="this.form.submit()">
                                <span class="flex-1">
                                    <i class="fas fa-moon text-indigo-500 mr-2"></i>Dark Theme
                                </span>
                            </label>
                            <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="theme" value="auto" {% if preference.theme == 'auto' %}checked{% endif %} class="mr-3" onchange="this.form.submit()">
                                <span class="flex-1">
                                    <i class="fas fa-adjust text-gray-500 mr-2"></i>Auto (System)
                                </span>
                            </label>
                        </div>
                    </form>
                </div>

                <!-- Default Dashboard -->
                <div>
                    <h4 class="text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-star mr-2 text-yellow-500"></i>Default Dashboard
                    </h4>
                    {% if preference.default_dashboard %}
                        <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm font-medium text-blue-900">{{ preference.default_dashboard.name }}</p>
                            <p class="text-xs text-blue-600 mt-1">This dashboard loads on login</p>
                        </div>
                    {% else %}
                        <p class="text-sm text-gray-500">No default dashboard set</p>
                    {% endif %}
                </div>

                <!-- Auto Refresh -->
                <div>
                    <h4 class="text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-sync-alt mr-2 text-green-600"></i>Auto Refresh
                    </h4>
                    <form method="post" action="{% url 'dashboard:update_preference' %}" id="refreshForm">
                        {% csrf_token %}
                        <input type="hidden" name="preference_type" value="refresh">
                        <label class="flex items-center justify-between p-3 border rounded-lg">
                            <span class="text-sm text-gray-700">Enable Auto Refresh</span>
                            <input type="checkbox" name="auto_refresh" {% if preference.auto_refresh %}checked{% endif %} class="toggle" onchange="this.form.submit()">
                        </label>
                        {% if preference.auto_refresh %}
                            <div class="mt-3">
                                <label class="text-xs text-gray-600">Refresh Interval (minutes)</label>
                                <input type="number" name="refresh_interval" value="{{ preference.refresh_interval }}" min="1" max="60" class="mt-1 w-full px-3 py-2 border rounded-lg" onchange="this.form.submit()">
                            </div>
                        {% endif %}
                    </form>
                </div>

                <!-- Notifications -->
                <div>
                    <h4 class="text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-bell mr-2 text-red-600"></i>Notifications
                    </h4>
                    <form method="post" action="{% url 'dashboard:update_preference' %}" id="notificationForm">
                        {% csrf_token %}
                        <input type="hidden" name="preference_type" value="notifications">
                        <div class="space-y-2">
                            <label class="flex items-center justify-between p-3 border rounded-lg">
                                <span class="text-sm text-gray-700">Email Notifications</span>
                                <input type="checkbox" name="email_notifications" {% if preference.email_notifications %}checked{% endif %} class="toggle" onchange="this.form.submit()">
                            </label>
                            <label class="flex items-center justify-between p-3 border rounded-lg">
                                <span class="text-sm text-gray-700">Push Notifications</span>
                                <input type="checkbox" name="push_notifications" {% if preference.push_notifications %}checked{% endif %} class="toggle" onchange="this.form.submit()">
                            </label>
                        </div>
                    </form>
                </div>

                <!-- Display Options -->
                <div>
                    <h4 class="text-sm font-bold text-gray-700 mb-3">
                        <i class="fas fa-eye mr-2 text-blue-600"></i>Display Options
                    </h4>
                    <form method="post" action="{% url 'dashboard:update_preference' %}" id="displayForm">
                        {% csrf_token %}
                        <input type="hidden" name="preference_type" value="display">
                        <div class="space-y-2">
                            <label class="flex items-center justify-between p-3 border rounded-lg">
                                <span class="text-sm text-gray-700">Show Sidebar</span>
                                <input type="checkbox" name="show_sidebar" {% if preference.show_sidebar %}checked{% endif %} class="toggle" onchange="this.form.submit()">
                            </label>
                            <label class="flex items-center justify-between p-3 border rounded-lg">
                                <span class="text-sm text-gray-700">Compact View</span>
                                <input type="checkbox" name="compact_view" {% if preference.compact_view %}checked{% endif %} class="toggle" onchange="this.form.submit()">
                            </label>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="border-t px-6 py-4">
                <a href="{% url 'dashboard:preferences' %}" class="block w-full text-center bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200">
                    <i class="fas fa-cog mr-2"></i>Advanced Settings
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Actions Panel -->
    <div class="fixed bottom-6 right-6 z-40">
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden" style="width: 280px;">
            <div class="bg-gradient-to-r from-green-500 to-green-600 px-4 py-3">
                <h3 class="text-white font-bold text-sm">
                    <i class="fas fa-bolt mr-2"></i>Quick Actions
                </h3>
            </div>
            <div class="p-3 space-y-2">
                <a href="{% url 'vehicles:vehicle_create' %}" class="block bg-blue-50 hover:bg-blue-100 text-blue-700 px-3 py-2 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-car mr-2"></i>Add Vehicle
                </a>
                <a href="{% url 'clients:client_create' %}" class="block bg-green-50 hover:bg-green-100 text-green-700 px-3 py-2 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-user-plus mr-2"></i>Add Client
                </a>
                <a href="{% url 'payments:payment_create' %}" class="block bg-yellow-50 hover:bg-yellow-100 text-yellow-700 px-3 py-2 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-credit-card mr-2"></i>Record Payment
                </a>
                <a href="{% url 'expenses:expense_create' %}" class="block bg-red-50 hover:bg-red-100 text-red-700 px-3 py-2 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-receipt mr-2"></i>Add Expense
                </a>
                <a href="{% url 'reports:reports_home' %}" class="block bg-purple-50 hover:bg-purple-100 text-purple-700 px-3 py-2 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-chart-bar mr-2"></i>View Reports
                </a>
                <a href="{% url 'dashboard:analytics' %}" class="block bg-indigo-50 hover:bg-indigo-100 text-indigo-700 px-3 py-2 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-analytics mr-2"></i>Analytics
                </a>
            </div>
        </div>
    </div>
</div>

<script>
    // Dashboard Selector Menu Toggle
    const dashboardSelectorBtn = document.getElementById('dashboardSelectorBtn');
    const dashboardSelectorMenu = document.getElementById('dashboardSelectorMenu');
    
    if (dashboardSelectorBtn) {
        dashboardSelectorBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            dashboardSelectorMenu.classList.toggle('hidden');
        });
    }

    // Close menu when clicking outside
    document.addEventListener('click', function(e) {
        if (dashboardSelectorMenu && !dashboardSelectorMenu.contains(e.target) && e.target !== dashboardSelectorBtn) {
            dashboardSelectorMenu.classList.add('hidden');
        }
    });

    // Preferences Sidebar Toggle
    const preferencesToggle = document.getElementById('preferencesToggle');
    const preferencesSidebar = document.getElementById('preferencesSidebar');
    const closeSidebar = document.getElementById('closeSidebar');
    
    if (preferencesToggle) {
        preferencesToggle.addEventListener('click', function() {
            preferencesSidebar.classList.remove('sidebar-closed');
            preferencesSidebar.classList.add('sidebar-open');
        });
    }
    
    if (closeSidebar) {
        closeSidebar.addEventListener('click', function() {
            preferencesSidebar.classList.remove('sidebar-open');
            preferencesSidebar.classList.add('sidebar-closed');
        });
    }

    // Refresh Dashboard
    const refreshDashboard = document.getElementById('refreshDashboard');
    if (refreshDashboard) {
        refreshDashboard.addEventListener('click', function() {
            this.querySelector('i').classList.add('fa-spin');
            location.reload();
        });
    }

    // Widget Management Functions
    function refreshWidget(widgetId) {
        // Implement widget refresh logic
        console.log('Refreshing widget:', widgetId);
        // You can add AJAX call here to refresh specific widget data
    }

    function deleteWidget(widgetId) {
        if (confirm('Are you sure you want to delete this widget?')) {
            // Implement delete logic
            window.location.href = `/dashboard/widget/${widgetId}/delete/`;
        }
    }

    // Grid/List View Toggle
    const gridViewBtn = document.getElementById('gridViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const widgetsGrid = document.getElementById('widgetsGrid');

    if (gridViewBtn && listViewBtn) {
        gridViewBtn.addEventListener('click', function() {
            gridViewBtn.classList.remove('bg-gray-100', 'text-gray-600');
            gridViewBtn.classList.add('bg-blue-100', 'text-blue-600');
            listViewBtn.classList.remove('bg-blue-100', 'text-blue-600');
            listViewBtn.classList.add('bg-gray-100', 'text-gray-600');
            // Update grid layout
        });

        listViewBtn.addEventListener('click', function() {
            listViewBtn.classList.remove('bg-gray-100', 'text-gray-600');
            listViewBtn.classList.add('bg-blue-100', 'text-blue-600');
            gridViewBtn.classList.remove('bg-blue-100', 'text-blue-600');
            gridViewBtn.classList.add('bg-gray-100', 'text-gray-600');
            // Update list layout
        });
    }

    // Auto-refresh based on preferences
    {% if preference.auto_refresh and preference.refresh_interval %}
        setInterval(function() {
            location.reload();
        }, {{ preference.refresh_interval }} * 60 * 1000);
    {% endif %}
</script>
{% endblock %}