{% extends 'base.html' %}
{% block title %}Report Generation Details - Vehicle Management{% endblock %}

{% block content %}
<style>
    .report-generation-container {
        padding: 2rem 1rem;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        min-height: 80vh;
    }
    
    .report-generation-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        padding: 2.5rem;
        position: relative;
        overflow: hidden;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .report-generation-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(90deg, #2563eb 0%, #7e22ce 100%);
    }
    
    .report-generation-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .report-generation-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #1e293b;
        margin: 0;
    }
    
    .status-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    .status-completed {
        background-color: #dcfce7;
        color: #166534;
    }
    
    .status-failed {
        background-color: #fee2e2;
        color: #991b1b;
    }
    
    .status-processing {
        background-color: #fef3c7;
        color: #92400e;
    }
    
    .status-pending {
        background-color: #e5e7eb;
        color: #374151;
    }
    
    .details-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .detail-card {
        padding: 1.5rem;
        background-color: #f8fafc;
        border-radius: 12px;
        border-left: 4px solid #2563eb;
    }
    
    .detail-card h3 {
        font-size: 1rem;
        color: #6b7280;
        margin-bottom: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .detail-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.75rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .detail-item:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }
    
    .detail-label {
        font-weight: 500;
        color: #6b7280;
        flex: 1;
    }
    
    .detail-value {
        font-weight: 600;
        color: #1e293b;
        text-align: right;
        flex: 2;
    }
    
    .file-info {
        background-color: #f8fafc;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border-left: 4px solid #7e22ce;
    }
    
    .file-info h3 {
        font-size: 1rem;
        color: #6b7280;
        margin-bottom: 1rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .file-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }
    
    .download-btn {
        padding: 0.875rem 1.75rem;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        margin-right: 1rem;
    }
    
    .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(16, 185, 129, 0.3);
    }
    
    .download-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .back-btn {
        padding: 0.875rem 1.75rem;
        background: white;
        color: #6b7280;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 极速赛车开奖直播 结果 历史记录 开奖网 开奖结果 开奖记录 开奖号码 开奖公告 开奖时间 开奖视频 开奖直播 开奖号码查询 开奖结果查询 开奖公告查询 开奖时间查询 开奖视频查询 开奖直播查询 开奖号码历史 开奖结果历史 开奖公告历史 开奖时间历史 开奖视频历史 开奖直播历史 开奖号码走势 开奖结果走势 开奖公告走势 开奖时间走势 开奖视频走势 开奖直播走势 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
    }
    
    .back-btn:hover {
        background-color: #f9fafb;
        border-color: #9ca3af;
    }
    
    .button-group {
        display: flex;
        justify-content: flex-start;
        margin-top: 2rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .report-generation-header {
            flex-direction: column;
            gap: 1rem;
        }
        
        .details-grid, .file-details {
            grid-template-columns: 1fr;
        }
        
        .detail-item {
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .detail-value {
            text-align: left;
        }
        
        .button-group {
            flex-direction: column;
            gap: 1rem;
        }
        
        .download-btn, .back-btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>

<div class="report-generation-container">
    <div class="report-generation-card">
        <div class="report-generation-header">
            <h1 class="report-generation-title">Report Generation Details</h1>
            <span class="status-badge status-{{ reportgeneration.status|lower }}">
                <i class="fas fa-{% if reportgeneration.status == 'Completed' %}check-circle{% elif reportgeneration.status == 'Failed' %}times-circle{% elif reportgeneration.status == 'Processing' %}spinner{% else %}clock{% endif %}"></i> 
                {{ reportgeneration.status }}
            </span>
        </div>
        
        <div class="details-grid">
            <div class="detail-card">
                <h3>Report Information</h3>
                <div class="detail-item">
                    <span class="detail-label">Template</span>
                    <span class="detail-value">{{ reportgeneration.template }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Generated At</span>
                    <span class="detail-value">{{ reportgeneration.generated_at|date:'Y-m-d H:i' }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Status</span>
                    <span class="detail-value">
                        {% if reportgeneration.status == "Completed" %}
                        <span class="status-badge status-completed">
                            <i class="fas fa-check-circle"></i> Completed
                        </span>
                        {% elif reportgeneration.status == "Failed" %}
                        <span class="status-badge status-failed">
                            <i class="fas fa-times-circle"></i> Failed
                        </span>
                        {% elif reportgeneration.status == "Processing" %}
                        <span class="status-badge status-processing">
                            <i class="fas fa-spinner fa-spin"></i> Processing
                        </span>
                        {% else %}
                        <span class="status-badge status-pending">
                            <i class="fas fa-clock"></i> {{ reportgeneration.status }}
                        </span>
                        {% endif %}
                    </span>
                </div>
            </div>
            
            {% if reportgeneration.parameters %}
            <div class="detail-card">
                <h3>Generation Parameters</h3>
                <div class="detail-item">
                    <span class="detail-value" style="text-align: left; font-weight: normal; white-space: pre-wrap;">{{ reportgeneration.parameters }}</span>
                </div>
            </div>
            {% endif %}
        </div>
        
        {% if reportgeneration.file_path or reportgeneration.file_name %}
        <div class="file-info">
            <h3>
                <i class="fas fa-file"></i> Generated File Information
            </h3>
            <div class="file-details">
                {% if reportgeneration.file_name %}
                <div class="detail-item">
                    <span class="detail-label">File Name</span>
                    <span class="detail-value">{{ reportgeneration.file_name }}</span>
                </div>
                {% endif %}
                
                {% if reportgeneration.file_path %}
                <div class="detail-item">
                    <span class="detail-label">File Path</span>
                    <span class="detail-value">{{ reportgeneration.file_path }}</span>
                </div>
                {% endif %}
                
                {% if reportgeneration.file_size %}
                <div class="detail-item">
                    <span class="detail-label">File Size</span>
                    <span class="detail-value">{{ reportgeneration.file_size }}</span>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        
        <div class="button-group">
            <!-- Download button - assuming the report is available for download -->
            {% if reportgeneration.status == "Completed" and reportgeneration.file_path %}
            <a href="{% url 'reports:reportgeneration-download' reportgeneration.pk %}" class="download-btn">
                <i class="fas fa-download"></i> Download Report
            </a>
            {% endif %}
            
            <a href="{% url 'reports:reportgeneration-list' %}" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to Report Generations
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add animation to the report generation card
        const reportGenerationCard = document.querySelector('.report-generation-card');
        reportGenerationCard.style.opacity = '0';
        reportGenerationCard.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            reportGenerationCard.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            reportGenerationCard.style.opacity = '1';
            reportGenerationCard.style.transform = 'translateY(0)';
        }, 100);
        
        // Format file size if it exists
        const fileSizeElement = document.querySelector('.detail-item:nth-child(3) .detail-value');
        if (fileSizeElement) {
            const fileSize = fileSizeElement.textContent.trim();
            if (!isNaN(fileSize) && fileSize !== '') {
                const size = parseInt(fileSize);
                if (size < 1024) {
                    fileSizeElement.textContent = size + ' B';
                } else if (size < 1024 * 1024) {
                    fileSizeElement.textContent = (size / 1024).toFixed(2) + ' KB';
                } else {
                    fileSizeElement.textContent = (size / (1024 * 1024)).toFixed(2) + ' MB';
                }
            }
        }
        
        // Format JSON parameters if they exist
        const parametersElement = document.querySelector('.detail-card:nth-child(2) .detail-value');
        if (parametersElement) {
            try {
                const content = parametersElement.textContent.trim();
                if (content.startsWith('{') || content.startsWith('[')) {
                    const parsed = JSON.parse(content);
                    parametersElement.textContent = JSON.stringify(parsed, null, 2);
                    parametersElement.style.fontFamily = 'monospace';
                    parametersElement.style.fontSize = '0.9rem';
                }
            } catch (e) {
                // Not JSON, leave as is
            }
        }
    });
</script>
{% endblock %}